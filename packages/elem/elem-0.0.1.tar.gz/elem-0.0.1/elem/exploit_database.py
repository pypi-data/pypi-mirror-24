import re
import os

class ExploitDatabase(object):
    def __init__(self,
                 edb_path=os.path.dirname(os.path.realpath(__file__))+"/exploit-database"):
        self.edb_path = edb_path

    def get_exploits_with_cves(self):
        exploits = {}
        pattern_string = 'CVE-\d{4}-\d{1,7}'
        pattern = re.compile(pattern_string)
        for root, dirnames, filenames in os.walk(self.edb_path):
            for filename in filenames:
                edb_file = open(os.path.join(root, filename), "r")
                content = edb_file.read()
                matches = pattern.findall(content, re.MULTILINE)
                edbid = os.path.splitext(filename)[0]
                if len(matches) > 0:
                    exploits[edbid] = dict(filename=edb_file.name,
                                           cves=list(set(matches)))
        return {edbid: exploit for (edbid, exploit) in exploits.iteritems() if 'windows' not in exploits[edbid]['filename']}
