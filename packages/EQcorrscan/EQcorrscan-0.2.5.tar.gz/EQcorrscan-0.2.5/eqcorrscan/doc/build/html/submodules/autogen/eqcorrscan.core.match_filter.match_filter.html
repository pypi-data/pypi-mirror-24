

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.6.3.2.3. eqcorrscan.core.match_filter.match_filter &mdash; EQcorrscan 0.2.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/EQcorrscan_logo.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="EQcorrscan 0.2.4 documentation" href="../../index.html"/>
        <link rel="up" title="4.6.3. match_filter" href="../core.match_filter.html"/>
        <link rel="next" title="4.6.3.2.4. eqcorrscan.core.match_filter.normxcorr2" href="eqcorrscan.core.match_filter.normxcorr2.html"/>
        <link rel="prev" title="4.6.3.2.2. eqcorrscan.core.match_filter.get_catalog" href="eqcorrscan.core.match_filter.get_catalog.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> EQcorrscan
          

          
            
            <img src="../../_static/EQcorrscan_logo.jpg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">1. Introduction to the EQcorrscan package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../updates.html">2. What&#8217;s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">3. EQcorrscan tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../core.html">4. Core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../core.html#brightness">4.1. Brightness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core.html#template-generation">4.2. Template generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core.html#matched-filter">4.3. Matched-Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core.html#lag-calc">4.4. Lag-Calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core.html#subspace">4.5. Subspace</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../core.html#api-docs">4.6. API-docs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../core.bright_lights.html">4.6.1. bright_lights</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core.lag_calc.html">4.6.2. lag_calc</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../core.match_filter.html">4.6.3. match_filter</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../core.match_filter.html#classes">4.6.3.1. Classes</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../core.match_filter.html#functions">4.6.3.2. Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../core.match_filter.html#private-functions">4.6.3.3. Private Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../core.subspace.html">4.6.4. subspace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core.template_gen.html">4.6.5. template_gen</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">5. Utils</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EQcorrscan</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../core.html">4. Core</a> &raquo;</li>
        
          <li><a href="../core.match_filter.html">4.6.3. match_filter</a> &raquo;</li>
        
      <li>4.6.3.2.3. eqcorrscan.core.match_filter.match_filter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/submodules/autogen/eqcorrscan.core.match_filter.match_filter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="eqcorrscan-core-match-filter-match-filter">
<h1>4.6.3.2.3. eqcorrscan.core.match_filter.match_filter<a class="headerlink" href="#eqcorrscan-core-match-filter-match-filter" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="eqcorrscan.core.match_filter.match_filter">
<code class="descclassname">eqcorrscan.core.match_filter.</code><code class="descname">match_filter</code><span class="sig-paren">(</span><em>template_names</em>, <em>template_list</em>, <em>st</em>, <em>threshold</em>, <em>threshold_type</em>, <em>trig_int</em>, <em>plotvar</em>, <em>plotdir='.'</em>, <em>cores=None</em>, <em>debug=0</em>, <em>plot_format='png'</em>, <em>output_cat=False</em>, <em>output_event=True</em>, <em>extract_detections=False</em>, <em>arg_check=True</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/eqcorrscan/core/match_filter.html#match_filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.core.match_filter.match_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Main matched-filter detection function.</p>
<p>Over-arching code to run the correlations of given templates with a     day of seismic data and output the detections based on a given threshold.
For a functional example see the tutorials.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>template_names</strong> (<em>list</em>) <span class="dash" /> List of template names in the same order as template_list</li>
<li><strong>template_list</strong> (<em>list</em>) <span class="dash" /> A list of templates of which each template is a
<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html#obspy.core.stream.Stream" title="(in ObsPy Documentation (1.0.3) v1.0)"><code class="xref py py-class docutils literal"><span class="pre">obspy.core.stream.Stream</span></code></a> of obspy traces containing seismic
data and header information.</li>
<li><strong>st</strong> (<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html#obspy.core.stream.Stream" title="(in ObsPy Documentation (1.0.3) v1.0)"><code class="xref py py-class docutils literal"><span class="pre">obspy.core.stream.Stream</span></code></a>) <span class="dash" /> A Stream object containing all the data available and
required for the correlations with templates given.  For efficiency
this should contain no excess traces which are not in one or more of
the templates.  This will now remove excess traces internally, but
will copy the stream and work on the copy, leaving your input stream
untouched.</li>
<li><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) <span class="dash" /> A threshold value set based on the threshold_type</li>
<li><strong>threshold_type</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) <span class="dash" /> The type of threshold to be used, can be MAD, absolute or av_chan_corr.
See Note on thresholding below.</li>
<li><strong>trig_int</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) <span class="dash" /> Minimum gap between detections in seconds.</li>
<li><strong>plotvar</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) <span class="dash" /> Turn plotting on or off</li>
<li><strong>plotdir</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) <span class="dash" /> Path to plotting folder, plots will be output here, defaults to run
location.</li>
<li><strong>cores</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) <span class="dash" /> Number of cores to use</li>
<li><strong>debug</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) <span class="dash" /> Debug output level, the bigger the number, the more the output.</li>
<li><strong>plot_format</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) <span class="dash" /> Specify format of output plots if saved</li>
<li><strong>output_cat</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) <span class="dash" /> Specifies if matched_filter will output an obspy.Catalog class
containing events for each detection. Default is False, in which case
matched_filter will output a list of detection classes, as normal.</li>
<li><strong>output_event</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) <span class="dash" /> Whether to include events in the Detection objects, defaults to True,
but for large cases you may want to turn this off as Event objects
can be quite memory intensive.</li>
<li><strong>extract_detections</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) <span class="dash" /> Specifies whether or not to return a list of streams, one stream per
detection.</li>
<li><strong>arg_check</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) <span class="dash" /> Check arguments, defaults to True, but if running in bulk, and you are
certain of your arguments, then set to False.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">If neither <cite>output_cat</cite> or <cite>extract_detections</cite> are set to <cite>True</cite>,
then only the list of <a class="reference internal" href="../core.match_filter.Detection.html#eqcorrscan.core.match_filter.Detection" title="eqcorrscan.core.match_filter.Detection"><code class="xref py py-class docutils literal"><span class="pre">eqcorrscan.core.match_filter.Detection</span></code></a>&#8216;s
will be output:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><a class="reference internal" href="../core.match_filter.Detection.html#eqcorrscan.core.match_filter.Detection" title="eqcorrscan.core.match_filter.Detection"><code class="xref py py-class docutils literal"><span class="pre">eqcorrscan.core.match_filter.Detection</span></code></a> detections for each
detection made.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<p class="rubric">If <cite>output_cat</cite> is set to <cite>True</cite>, then the
<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.event.Catalog.html#obspy.core.event.Catalog" title="(in ObsPy Documentation (1.0.3) v1.0)"><code class="xref py py-class docutils literal"><span class="pre">obspy.core.event.Catalog</span></code></a> will also be output:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Catalog containing events for each detection, see above.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.event.Catalog.html#obspy.core.event.Catalog" title="(in ObsPy Documentation (1.0.3) v1.0)"><code class="xref py py-class docutils literal"><span class="pre">obspy.core.event.Catalog</span></code></a></td>
</tr>
</tbody>
</table>
<p class="rubric">If <cite>extract_detections</cite> is set to <cite>True</cite> then the list of
<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html#obspy.core.stream.Stream" title="(in ObsPy Documentation (1.0.3) v1.0)"><code class="xref py py-class docutils literal"><span class="pre">obspy.core.stream.Stream</span></code></a>&#8216;s will also be output.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of <a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.html#obspy.core.stream.Stream" title="(in ObsPy Documentation (1.0.3) v1.0)"><code class="xref py py-class docutils literal"><span class="pre">obspy.core.stream.Stream</span></code></a>&#8216;s for each detection, see
above.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Plotting within the match-filter routine uses the Agg backend
with interactive plotting turned off.  This is because the function
is designed to work in bulk.  If you wish to turn interactive
plotting on you must import matplotlib in your script first, when you
them import match_filter you will get the warning that this call to
matplotlib has no effect, which will mean that match_filter has not
changed the plotting behaviour.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Data overlap:</strong></p>
<p>Internally this routine shifts and trims the data according to the
offsets in the template (e.g. if trace 2 starts 2 seconds after trace 1
in the template then the continuous data will be shifted by 2 seconds
to align peak correlations prior to summing).  Because of this,
detections at the start and end of continuous data streams
<strong>may be missed</strong>.  The maximum time-period that might be missing
detections is the maximum offset in the template.</p>
<p class="last">To work around this, if you are conducting matched-filter detections
through long-duration continuous data, we suggest using some overlap
(a few seconds, on the order of the maximum offset in the templates)
in the continous data.  You will then need to post-process the
detections (which should be done anyway to remove duplicates).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Thresholding:</strong></p>
<p><strong>MAD</strong> threshold is calculated as the:</p>
<div class="math">
\[threshold {\times} (median(abs(cccsum)))\]</div>
<p>where <span class="math">\(cccsum\)</span> is the cross-correlation sum for a given template.</p>
<p><strong>absolute</strong> threshold is a true absolute threshold based on the
cccsum value.</p>
<p><strong>av_chan_corr</strong> is based on the mean values of single-channel
cross-correlations assuming all data are present as required for the
template, e.g:</p>
<div class="math">
\[av\_chan\_corr\_thresh=threshold \times (cccsum / len(template))\]</div>
<p class="last">where <span class="math">\(template\)</span> is a single template from the input and the
length is the number of channels within this template.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The output_cat flag will create an <code class="xref py py-class docutils literal"><span class="pre">obspy.core.eventCatalog</span></code>
containing one event for each
<a class="reference internal" href="../core.match_filter.Detection.html#eqcorrscan.core.match_filter.Detection" title="eqcorrscan.core.match_filter.Detection"><code class="xref py py-class docutils literal"><span class="pre">eqcorrscan.core.match_filter.Detection</span></code></a>&#8216;s generated by
match_filter. Each event will contain a number of comments dealing
with correlation values and channels used for the detection. Each
channel used for the detection will have a corresponding
<code class="xref py py-class docutils literal"><span class="pre">obspy.core.event.Pick</span></code> which will contain time and
waveform information. <strong>HOWEVER</strong>, the user should note that, at
present, the pick times do not account for the
prepick times inherent in each template. For example, if a template
trace starts 0.1 seconds before the actual arrival of that phase,
then the pick time generated by match_filter for that phase will be
0.1 seconds early. We are working on a solution that will involve
saving templates alongside associated metadata.</p>
</div>
</dd></dl>

</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="eqcorrscan.core.match_filter.normxcorr2.html" class="btn btn-neutral float-right" title="4.6.3.2.4. eqcorrscan.core.match_filter.normxcorr2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="eqcorrscan.core.match_filter.get_catalog.html" class="btn btn-neutral" title="4.6.3.2.2. eqcorrscan.core.match_filter.get_catalog" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, 2016: EQcorrscan developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.2.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>