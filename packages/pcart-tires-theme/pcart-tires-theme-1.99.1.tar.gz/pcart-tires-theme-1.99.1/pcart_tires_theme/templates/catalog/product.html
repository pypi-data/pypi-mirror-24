{% extends CMS_TEMPLATE %}
{% load i18n l10n cms_tags pcart_catalog pcart_core theme_tags pcart_reviews pcart_statistics thumbnail staticfiles %}

{% block title %}{{product|default:product.page_title}}{% endblock %}

{% block breadcrumb %}{% include "catalog/_product_breadcrumb.html" %}{% endblock %}

{% block sidebar %}
Under construction
{% endblock %}

{% block content %}
<div itemscope itemtype="http://schema.org/Product" class="product-scope">

    <meta itemprop="url" content="{% build_absolute_uri product.get_absolute_url %}" />
    <meta itemprop="image" content="{{im.image|thumbnail_url:'product_zoom'}}" />

    <div class="product_wrap">
        <div class="row">
            <div class="col-sm-6 col-lg-5 product_images">
                {% with p_images=product.images.all %}
                    {% if p_images %}
                        {% if p_images|len > 1 %}
                            {% with image=p_images.first %}
                                <img id="elevatezoom_big" src="{{image.image|thumbnail_url:'product_large'}}" alt="{{image}}" data-zoom-image="{{image.image|thumbnail_url:'product_zoom'}}" />
                            {% endwith %}

                            <div id="elevatezoom_gallery">
                                {% for image in p_images %}
                                    <a href="#" data-image="{{image.image|thumbnail_url:'product_large'}}"
                                        data-zoom-image="{{image.image|thumbnail_url:'product_zoom'}}">
                                        <img src="{{image.image|thumbnail_url:'product_small'}}" alt="{{image}}" />
                                    </a>
                                {% endfor %}
                            </div>
                        {% else %}
                            {% for image in p_images %}
                            <img id="elevatezoom_big" class="fancybox"
                                 src="{{image.image|thumbnail_url:'product_large'}}"
                                 data-zoom-image="{{image.image|thumbnail_url:'product_zoom'}}" alt="{{image}}" />
                            {% endfor %}
                        {% endif %}
                    {% endif %}
                {% endwith %}
            </div>

            <div class="col-sm-6 col-lg-7">
                <div itemprop="name" class="product_name">{{product.title}}</div>

                {% if product.available %}
                    <form action="{% add_to_cart_url %}" method="post" enctype="multipart/form-data"
                          class='form-horizontal' id="product-actions">
                        <input type="hidden" name="item-id" value="{{product.id}}">
                        <input type="hidden" name="next" value="{{product.get_absolute_url}}">
                        <input type="hidden" name="item-type" value="{{product.type}}">
                        <input type="hidden" name="price" value="{{product.price|unlocalize}}">
                        <input type="hidden" name="weight" value="{{product.weight|unlocalize}}">

                        <div class="options clearfix">
                            <div id="product_price"><p class="price product-price"></p>  </div>

                            <div id="purchase">
                                <label for="quantity">{% trans "Qty" %}: </label><input min="1" type="number" id="quantity" name="quantity" value="1" class="form-control input-small" />
                                <button class="btn btn-cart" type="submit" id="add-to-cart">{% trans "Add to cart" %}</button>
                                <a class="btn btn-alt" style="margin-top:15px;" href="#" title="{% trans 'Compare' %}"><i class="fa fa-balance-scale"></i></a>
                                <a class="btn btn-alt" style="margin-top:15px;" href="#" title="{% trans 'Add to wishlist' %}"><i class="fa fa-heart"></i></a>
                            </div>
                        </div><!-- /.options -->
                    </form>
                {% else %}
                    <div id="product-actions" class="sold-out">
                        <div id="purchase">
                            <p class="price">{{product.status}}</p>
                        </div>
                    </div>
                {% endif %}

                <div class="product_details">
                    <div class="product_type">{% trans "Type" %}: {{product.product_type|default:"-"}}</div>
                    <div class="product_vendor">{% trans "Vendor" %}: {{product.vendor|default:"-"}}</div>

                    {% for prop in product.product_type.properties.all %}
                        {% with value=product.properties|get_element:prop.title %}
                        {% if value %}<div>{% trans prop.title %}: {{value}}</div>{% endif %}
                        {% endwith %}
                    {% endfor %}
                </div>

                {% if product.description %}
                <div id="product_description" class="rte" itemprop="description">
                    <h4>{% trans "Description" %}:</h4>
                    {{ product.description }}
                </div>
                {% endif %}

                {% include 'snippets/snippet-addthis.html' %}
            </div>
        </div><!-- /.row -->
    </div><!-- /.product_wrap -->
</div>

{# include 'widget-related-products' #}

<script>
jQuery(function($) {
    /* product image zoom */
    $(window).load(function(){
        $("#elevatezoom_big").elevateZoom({
            gallery : "elevatezoom_gallery",
            zoomType : "window",
            scrollZoom : true,
            zoomWindowFadeIn : 500,
            zoomLensFadeIn: 500,
            imageCrossfade: true,
            zoomWindowWidth : 345,
            zoomWindowHeight : 345,
            zoomWindowOffetx : 12,
            zoomWindowOffety : 0,
            borderSize : 1,
            borderColour : "{{ settings.border_color }}"
        });
    });

    /* big image fancybox */
    $("#elevatezoom_big").bind("click", function() {
        var ez = $('#elevatezoom_big').data('elevateZoom');
        $.fancybox(ez.getGalleryList());
        return false;
    });

    /* thumbs slider */
    $('#elevatezoom_gallery').bxSlider({
        infiniteLoop: true,
        minSlides: 1,
        maxSlides: 3,
        moveSlides: 1,
        slideWidth: 101,
        slideMargin: 12,
        pager: false,
        prevText: '',
        nextText: ''
    });
});
</script>

{% if product.available %}
<script>

    var selectCallback = function(variant, selector) {
        if ( variant && variant.available ) {
            jQuery('#add-to-cart').removeAttr('disabled').removeClass('disabled'); // remove unavailable class from add-to-cart button, and re-enable button

            if( variant.price < variant.compare_at_price ){
                jQuery('#product_price .price').addClass('product_price_sale').html('<span class="money">' + Shopify.formatMoney(variant.price, "{{ shop.money_format }}") + '</span><span class="money compare-at-price">' + Shopify.formatMoney(variant.compare_at_price, "{{ shop.money_format }}") + '</span>');
            }
            else {
                jQuery('#product_price .price').html('<span class="money">' + Shopify.formatMoney(variant.price, "{{ shop.money_format }}") + '</span>');
            };
        }
        else {
            jQuery('#add-to-cart').addClass('disabled').attr('disabled', 'disabled'); // set add-to-cart button to unavailable class and disable button

            var message = variant ? "Sold Out" : "Unavailable";
            jQuery('#product_price .price').text(message);
        };

        if (variant && variant.featured_image) {
            var originalImage = $("#elevatezoom_big");
            var newImage = variant.featured_image;
            var element = originalImage[0];

            Shopify.Image.switchImage(newImage, element, function (newImageSizedSrc, newImage, element) {
                jQuery('#elevatezoom_big').attr('src', newImageSizedSrc).attr('data-zoom-image', newImageSizedSrc);

                jQuery("#elevatezoom_gallery a").each(function(){
                    if ( jQuery(this).attr('data-zoom-image').replace(/\?v=.*/ , '') == newImageSizedSrc.replace(/\?v=.*/ , '') ) {
                        jQuery(this).trigger('click');
                    };
                });
            });
        };
    };
</script>
{% endif %}
{% endblock %}

{% block extra_js %}
{# 'option_selection.js'|shopify_asset_url|script_tag #}
{{ 'jquery.bxslider.min.js'|asset_url|script_tag }}
{{ 'jquery.elevatezoom.js'|asset_url|script_tag }}
{{ 'jquery.fancybox.min.js'|asset_url|script_tag }}
{% track_product_visit product %}
{% endblock %}
