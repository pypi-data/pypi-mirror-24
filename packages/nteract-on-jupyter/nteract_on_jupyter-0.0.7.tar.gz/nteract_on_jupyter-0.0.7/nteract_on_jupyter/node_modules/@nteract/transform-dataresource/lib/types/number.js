"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _isNaN2 = require("lodash/isNaN");

var _isNaN3 = _interopRequireDefault(_isNaN2);

var _toNumber2 = require("lodash/toNumber");

var _toNumber3 = _interopRequireDefault(_toNumber2);

var _isString2 = require("lodash/isString");

var _isString3 = _interopRequireDefault(_isString2);

var _isNumber2 = require("lodash/isNumber");

var _isNumber3 = _interopRequireDefault(_isNumber2);

exports.castNumber = castNumber;

var _config = require("../config");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Module API

function castNumber(format, value) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var percentage = false;
  var currency = options.currency || false;
  var decimalChar = options.decimalChar || _DEFAULT_DECIMAL_CHAR;
  var groupChar = options.groupChar || _DEFAULT_GROUP_CHAR;
  if (!(0, _isNumber3.default)(value)) {
    if (!(0, _isString3.default)(value)) {
      return _config.ERROR;
    }
    if (!value.length) {
      return _config.ERROR;
    }
    value = value.replace(new RegExp("\\s", "g"), "");
    value = value.replace(new RegExp("[" + decimalChar + "]", "g"), ".");
    value = value.replace(new RegExp("[" + groupChar + "]", "g"), "");
    if (currency) {
      value = value.replace(new RegExp("[" + _CURRENCY_CHAR + "]", "g"), "");
    }
    var result = value.replace(new RegExp("[" + _PERCENT_CHAR + "]", "g"), "");
    if (value !== result) {
      percentage = true;
      value = result;
    }
    try {
      value = (0, _toNumber3.default)(value);
    } catch (error) {
      return _config.ERROR;
    }
  }
  if ((0, _isNaN3.default)(value)) {
    return _config.ERROR;
  }
  if (percentage) {
    value = value / 100;
  }
  return value;
}

// Internal

var _DEFAULT_DECIMAL_CHAR = ".";
var _DEFAULT_GROUP_CHAR = "";
var _PERCENT_CHAR = "%‰‱％﹪٪";
var _CURRENCY_CHAR = "$£€";