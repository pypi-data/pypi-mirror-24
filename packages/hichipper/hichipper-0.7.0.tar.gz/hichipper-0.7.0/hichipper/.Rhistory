samples ="A"
readstats <- foreach(sample = samples, .combine="rbind") %do% {
sfilename <- "/Users/lareauc/Downloads/ESO26_separate/ESO26_r1.stat"
#sfilename <- file.path(paste0(cwd, "/", outdir, "/", sample, ".stat"))
rs <- read.table(sfilename, header=FALSE, stringsAsFactors = FALSE, sep = "=")
anchors <- rbind(anchors, data.frame(sample= sample, npeaks = rs[12,2] ))
min_length <- rs[13,2]
max_length <- rs[14,2]
readsinanchors <- rs[15,2]
rso <- cbind(sample=sample, rs[c(1:8, 10, 15),])
colnames(rso) <- c("sample", "metric", "count")
rso
}
suppressMessages(library(ggplot2))
suppressMessages(library(foreach))
suppressMessages(library(reshape2))
suppressMessages(library(readr))
suppressMessages(library(knitr))
suppressMessages(library(DT))
suppressMessages(library(networkD3))
readstats <- foreach(sample = samples, .combine="rbind") %do% {
sfilename <- "/Users/lareauc/Downloads/ESO26_separate/ESO26_r1.stat"
#sfilename <- file.path(paste0(cwd, "/", outdir, "/", sample, ".stat"))
rs <- read.table(sfilename, header=FALSE, stringsAsFactors = FALSE, sep = "=")
anchors <- rbind(anchors, data.frame(sample= sample, npeaks = rs[12,2] ))
min_length <- rs[13,2]
max_length <- rs[14,2]
readsinanchors <- rs[15,2]
rso <- cbind(sample=sample, rs[c(1:8, 10, 15),])
colnames(rso) <- c("sample", "metric", "count")
rso
}
min_length <- 0
max_length <- 0
anchors <- data.frame()
# Creates a dataframe of summary statistics from the individual sample log output files
readstats <- foreach(sample = samples, .combine="rbind") %do% {
sfilename <- "/Users/lareauc/Downloads/ESO26_separate/ESO26_r1.stat"
#sfilename <- file.path(paste0(cwd, "/", outdir, "/", sample, ".stat"))
rs <- read.table(sfilename, header=FALSE, stringsAsFactors = FALSE, sep = "=")
anchors <- rbind(anchors, data.frame(sample= sample, npeaks = rs[12,2] ))
min_length <- rs[13,2]
max_length <- rs[14,2]
readsinanchors <- rs[15,2]
rso <- cbind(sample=sample, rs[c(1:8, 10, 15),])
colnames(rso) <- c("sample", "metric", "count")
rso
}
mincar <- paste0(round(as.numeric(min_length)/1000), "Kb")
maxcar <- paste0(round(as.numeric(max_length)/1000000), "Mb")
np <- paste0("Valid_Intra_", mincar, "-",  maxcar)
npa <- paste0("Valid_Intra_anchor_", mincar,"-", maxcar)
metrics <- c("Total_PETs", "Mapped_unique_quality", "Mapped_unique_quality_valid", "Valid_Intra", #1-4
paste0("Valid_Intra_<", mincar), np, #5,6
paste0("Valid_Intra_>", maxcar), #7
paste0("Valid_Intra_anchor"), npa, "HQ_Reads_In_Anchors") #8, 10, 15
readstats$metric <- factor(rep(metrics, length(samples)), levels=metrics)
readstats
tab <- suppressMessages(acast(readstats, metric~sample, sum))
tab <- rbind(tab, Long_Range_Interactions = tab[6,] + tab[7,])
tab_percent <- 100*sweep(tab, 2, tab["Total_PETs",], FUN="/")
tab_summary
tab_percent
dim(tab_percent)
tab <- suppressMessages(acast(readstats, metric~sample, sum))
tab <- rbind(tab, Long_Range_Interactions = tab[6,] + tab[7,])
tab_percent <- 100*sweep(tab, 2, tab["Total_PETs",], FUN="/")
tab_summary <- rbind(format(tab_percent[c(9,11,2,10),,drop = FALSE], digits = 2, nsmall = 2),
as.character(tab[1,,drop = FALSE]) )
rownames(tab_summary) <- c(paste0("% in Loops"),
"% Long Range Interaction",
"% HQ Unique Mapped",
"% Reads in Anchors",
"Total PETs")
tab_summary <- tab_summary[5:1,, drop = FALSE]
tab_summary
